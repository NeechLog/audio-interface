"""
Example client usage for {{ service_name }} service.
"""

import time
import logging
import grpc
from {{ module_name }}.client import {{ package_name }}
from {{ module_name }} import {{ pb2_module_name }}

def run_example():
    """Run client example."""
    print("Connecting to {{ service_name }} at localhost:50051...")
    
    # NOTE: Make sure the server is running first!
    # Run: uv run generated_packages/packages/audiocloneserver/audiocloneserver/server_example.py
    
    with {{ package_name }}("localhost:50051") as client:
        # 1. Unary call example
        print("\n--- 1. Unary Clone ---")
        try:
            request = {{ pb2_module_name }}.CloneRequest()
            request.request_audio_message.audio_binary = b"Input audio data"
            request.sample_audio_message.audio_binary = b"Target voice sample"
            request.model_name = "default-v1"
            
            response = client.clone(request)
            print(f"Cloned audio size: {len(response.cloned_audio_message.audio_binary)} bytes")
            print(f"Model used: {response.model_name}")
            print(f"Status: {response.meta.status_code}")
            
        except grpc.RpcError as e:
            print(f"RPC failed: {e}")

        # 2. Streaming call example
        print("\n--- 2. Streaming Clone ---")
        def request_generator():
            chunks = [b"Chunk 1", b"Chunk 2", b"Chunk 3"]
            for chunk in chunks:
                print(f"Sending audio chunk: {len(chunk)} bytes")
                req = {{ pb2_module_name }}.CloneRequest()
                req.request_audio_message.audio_binary = chunk
                # Sample might be needed only once or per chunk depending on logic, sending empty for subsequent chunks here as example
                yield req
                time.sleep(0.5)
                
        try:
            responses = client.stream_clone(request_generator())
            for response in responses:
                print(f"Received cloned chunk: {len(response.cloned_audio_message.audio_binary)} bytes")
                
        except grpc.RpcError as e:
            print(f"Streaming RPC failed: {e}")

if __name__ == "__main__":
    logging.basicConfig()
    run_example()
