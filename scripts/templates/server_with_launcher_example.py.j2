"""
{{ description }}

Example usage of the {{ service_name }} server with configurable launcher.
"""

import argparse
import logging
import sys
from {{ module_name }}.grpc_server_launcher import start_grpc_server
from {{ module_name }} import {{ grpc_module_name }}, {{ pb2_module_name }}
from {{ module_name }}.server import {{ service_name }}Servicer

# Define handlers
{{ handler_definitions }}

def main():
    """Main entry point for the server."""
    parser = argparse.ArgumentParser(description="{{ description }} Server")
    parser.add_argument("--port", type=int, default=50051, help="Port to listen on")
    parser.add_argument("--workers", type=int, default=10, help="Number of worker threads per process")
    parser.add_argument("--processes", type=int, default=1, help="Number of processes to spawn")
    parser.add_argument("--log-level", default="INFO", choices=["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"], help="Logging level")
    parser.add_argument("--log-file", default="server.log", help="Path to log file")
    parser.add_argument("--daemon", action="store_true", help="Run as daemon in background")
    parser.add_argument("--pid-file", help="Path to PID file (useful for managing daemon process)")
    parser.add_argument("--max-message-size", type=int, default=4, help="Max message size in MB")
    
    args = parser.parse_args()
    
    # Simple console logging for startup info before launcher takes over
    if not args.daemon:
        logging.basicConfig(
            level=getattr(logging, args.log_level.upper()),
            format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
            stream=sys.stdout
        )
    
    print(f"Starting server on port {args.port}...")
    if args.daemon:
        print(f"Running in background. Logs will be written to {args.log_file}")
    
    start_grpc_server(
        service_add_func={{ grpc_module_name }}.add_{{ service_name }}Servicer_to_server,
        service_class={{ service_name }}Servicer,
        port=args.port,
        max_workers=args.workers,
        num_processes=args.processes,
        log_level=args.log_level,
        log_file=args.log_file,
        daemon=args.daemon,
        pid_file=args.pid_file,
        max_message_length_mb=args.max_message_size,
        service_init_kwargs={
            {{ handler_kwargs_dict }}
        }
    )

if __name__ == '__main__':
    main()
